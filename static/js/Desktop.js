(function(){
function e(a){return document.getElementById(a)}var h={greyLight:{name:"greyLight",i:"#edeeec"},blue:{name:"blue",i:"#c4e8f7"},green:{name:"green",i:"#b8ddbe"},yellow:{name:"yellow",i:"#fdbc4b",default:!0},red:{name:"red",i:"#fd794b"},black:{name:"black",i:"#383c47"}};function k(){this.size=50;this.color=h.ga;this.opacity=1;this.mode="move"}"use strict";function l(a,b,c){this.x=Number(0==a?0:a);this.y=Number(0==b?0:b);this.z=Number(0==c?0:c)}function m(a,b){return new l(a.x-b.x,a.y-b.y,a.z-b.z)}
function n(a,b){return new l(a.x+b.x,a.y+b.y,a.z+b.z)}l.prototype.rotate=function(a,b){b=b/180*Math.PI;var c=Math.sin(b);b=Math.cos(b);return p(this,[[("x"===a?1:b).toFixed(15),("z"===a?c:0).toFixed(15),("y"===a?-1*c:0).toFixed(15)],[("z"===a?-1*c:0).toFixed(15),("y"===a?1:b).toFixed(15),("x"===a?c:0).toFixed(15)],[("y"===a?c:0).toFixed(15),("x"===a?-1*c:0).toFixed(15),("z"===a?1:b).toFixed(15)]])};
l.prototype.A=function(a,b){var c=a.o.normalize(),d=c.x,g=c.y;c=c.z;var f=b/180*Math.PI;b=Math.sin(f);f=Math.cos(f);return n(p(m(this,a.w),[[d*d*(1-f)+f,g*d*(1-f)+c*b,c*d*(1-f)-g*b],[d*g*(1-f)-c*b,g*g*(1-f)+f,c*g*(1-f)+d*b],[d*c*(1-f)+g*b,g*c*(1-f)-d*b,c*c*(1-f)+f]]),a.w)};l.prototype.normalize=function(){var a=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return new l(this.x*a,this.y*a,this.z*a)};
function p(a,b){return new l((b[0][0]*a.x+b[1][0]*a.y+b[2][0]*a.z).toFixed(15),(b[0][1]*a.x+b[1][1]*a.y+b[2][1]*a.z).toFixed(15),(b[0][2]*a.x+b[1][2]*a.y+b[2][2]*a.z).toFixed(15))}function q(a,b){return a.x*b.x-a.y*b.y-a.z*b.z}"use strict";function r(a,b){var c=new l(0,0,0);a=m(a,c);b=m(b,c);if(a.x/b.x===a.y/b.y&&a.x/b.y===a.z/b.z&&a.y/b.y===a.z/b.z)throw Error("Cannot create plane, r1 and r2 are linearly dependent");this.n=new l(b.y*a.z-b.z*a.y,b.z*a.x-b.x*a.z,b.x*a.y-b.y*a.x);this.W=c}"use strict";
function t(a,b){this.w=a;this.o=m(b,a);this.V=b}t.prototype.rotate=function(a,b){0<a&&(this.o=this.o.rotate("x",a));0<b&&(this.o=this.o.rotate("z",b))};t.prototype.A=function(a,b){return new t(this.w.A(a,b),this.V.A(a,b))};
function u(){this.socket=io.connect(document.location.protocol+"//"+document.location.host);this.socket.on("mobile-on",function(){w()});this.socket.on("orientation",function(a){x.F.alpha=a.alpha;x.F.beta=a.beta});this.socket.on("brush-change",function(a){y(a)});this.socket.on("brush-mode",function(a){z(a)})}function A(a){this.socket.emit("desktop-getcode","nothing",function(b){a(b)})}
function B(){this.b={};this.b.canvas=e("canvas-drawing-main");this.b.toolbar=e("toolbar");this.b.O=e("setup-container");this.b.I=e("brush-circle");this.b.S=e("brush-anchor");this.b.U=e("cursor-anchor");this.b.ca=e("toolbar-item--clear");this.b.R=e("brush-stroke-preview");this.b.ca.addEventListener("click",function(){C()});this.b.ba=e("toolbar-colors");for(var a in h)if(h.hasOwnProperty(a)){var b=document.createElement("div");b.className="toolbar__item toolbar__item--color";b.name="color";b.dataset.T=
h[a].name;b.style.background=h[a].i;h[a].default&&(b.classList.add("active"),D(h[a].name));b.addEventListener("click",function(){D(this.dataset.T)});this.b.ba.appendChild(b)}this.f=[];a=document.querySelectorAll(".toolbar__item");for(b=0;b<a.length;++b){var c=a[b].getBoundingClientRect(),d=c.width/2;this.f.push({element:a[b],Y:d,position:{x:c.left+d,y:c.top+d}})}this.l=this.j=this.N=this.M=this.m=this.h=0;this.u="move";this.C=this.v=!1;this.D=!0;document.body.classList.add("app-is-ready")}
function w(){E();this.K=this.H;this.J=this.da;var a=2*this.H,b=this.K/2,c=this.J/2;this.Z=new r(new l(this.K,0,0),new l(0,this.J,0));this.ea=new t(new l(b-100,c,a),new l(b+100,c,a));this.fa=new t(new l(b,c-100,a),new l(b,c+100,a));this.X=new t(new l(b,c,a),new l(b,c,a/2));this.b.O.classList.add("setup-disappear");window.setTimeout(function(){this.b.O.classList.add("setup-hide")},400);F()}function E(){this.H=window.innerWidth;this.da=window.innerHeight}
function G(a){this.b.I.setAttribute("r",a.size/2);H(a.size);this.b.R.style.strokeWidth=a.size}function I(a){this.u=a;this.v=!0}function D(a){this.b.I.style.fill=h[a].i;J(h[a].i);this.b.R.style.stroke=h[a].i}
function F(){var a=x.F;a=this.X.A(this.fa,180-a.alpha).A(this.ea,180-a.beta);var b=this.Z,c=q(m(b.W,a.w),b.n),d=q(a.o,b.n);0==c||0==d?a=null:(b=a.o,c/=d,a=n(new l(b.x*c,b.y*c,b.z*c),a.w));c=a.y/2;this.h=Math.round(a.x/2);this.m=Math.round(c);a=15-(Math.abs(this.h-this.M)+Math.abs(this.m-this.N))/5;a=Math.max(a,3);"draw"!==this.u&&(this.j=Math.round(this.h),this.l=Math.round(this.m));this.h<=-.3*this.H&&this.D?(this.D=!1,this.C=0==this.C?!0:!1):40<=this.h&&(this.D=!0);if("secondary"===this.u||1==this.C)for(document.body.classList.add("toolbar-is-active"),
c=0;c<this.f.length;++c){b=this.h;d=this.m;var g=this.f[c].position.x,f=this.f[c].position.y,v=this.f[c].Y;(b-g)*(b-g)+(d-f)*(d-f)>=v*v?this.f[c].element.classList.remove("hover"):(this.f[c].element.classList.add("hover"),"draw"===this.u&&this.f[c].element.click())}else for(document.body.classList.remove("toolbar-is-active"),c=0;c<this.f.length;++c)this.f[c].element.classList.contains("hover")&&(this.f[c].element.click(),this.f[c].element.classList.remove("hover"));c=this.h;b=this.m;d=this.j;g=this.l;
1600<=(c-d)*(c-d)+(b-g)*(b-g)&&(this.j=Math.round(this.j+(this.h-this.j)/a),this.l=Math.round(this.l+(this.m-this.l)/a));this.b.S.style.transform="translate3d("+this.j+"px,"+this.l+"px,0)";this.b.U.style.transform="translate3d("+this.h+"px,"+this.m+"px,0)";"draw"===this.u&&0==this.C?!0===this.v?(K(this.j,this.l),this.v=!1):L(this.j,this.l):!0===this.v&&(M(),this.v=!1);this.N=this.m;this.M=this.h;window.requestAnimationFrame(F.bind(this))}function N(){this.F={alpha:0,beta:0,gamma:0}}N.prototype={};
var x=new N;
function O(){console.log("canvas init");this.canvas=e("canvas-drawing-main");this.L=this.canvas.getContext("2d");this.aa=e("canvas-container");this.P=getComputedStyle(this.aa);this.canvas.width=parseInt(this.P.getPropertyValue("width"));this.canvas.height=parseInt(this.P.getPropertyValue("height"));this.g=e("canvas-drawing-tmp");this.a=this.g.getContext("2d");this.g.width=this.canvas.width;this.g.height=this.canvas.height;this.a.lineWidth=20;this.a.lineJoin="round";this.a.lineCap="round";this.a.strokeStyle=
"blue";this.a.fillStyle="blue";this.s={x:0,y:0};this.c=[];this.G=!1;this.g.addEventListener("mousemove",function(a){console.log("x"+a.offsetX);console.log("y"+a.offsetY)},!1)}function J(a){this.a.strokeStyle=a;this.a.fillStyle=a}function H(a){this.a.lineWidth=a}function C(){this.L.clearRect(0,0,this.g.width,this.g.height)}function L(a,b){this.G&&(this.s.x=a,this.s.y=b,P())}function K(a,b){this.G=!0;this.s.x=a;this.s.y=b;this.c.push({x:a,y:b});P()}
function M(){this.G=!1;this.L.drawImage(this.g,0,0);this.a.clearRect(0,0,this.g.width,this.g.height);this.c=[]}
function P(){this.c.push({x:this.s.x,y:this.s.y});if(3>this.c.length){var a=this.c[0];this.a.beginPath();this.a.arc(a.x,a.y,this.a.lineWidth/2,0,2*Math.PI,!0);this.a.fill();this.a.closePath();console.log(a)}else{this.a.clearRect(0,0,this.g.width,this.g.height);this.a.beginPath();this.a.moveTo(this.c[0].x,this.c[0].y);for(a=1;a<this.c.length-2;a++)this.a.quadraticCurveTo(this.c[a].x,this.c[a].y,(this.c[a].x+this.c[a+1].x)/2,(this.c[a].y+this.c[a+1].y)/2);this.a.quadraticCurveTo(this.c[a].x,this.c[a].y,
this.c[a+1].x,this.c[a+1].y);this.a.stroke()}}function Q(){this.B=new k;u();O();B();A(function(){})}function y(a){this.B=a;G(this.B)}function z(a){this.B.mode=a;I(this.B.mode)}document.addEventListener("DOMContentLoaded",function(){Q()});
}).call(this)
