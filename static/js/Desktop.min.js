(function(){
var e={ea:{name:"greyLight",i:"#edeeec"},blue:{name:"blue",i:"#c4e8f7"},green:{name:"green",i:"#b8ddbe"},ca:{name:"yellow",i:"#fdbc4b",default:!0},red:{name:"red",i:"#fd794b"},da:{name:"black",i:"#383c47"}};function h(){this.size=50;this.color=e.ca;this.opacity=1;this.mode="move"}"use strict";function k(a,b,c){this.x=Number(0==a?0:a);this.y=Number(0==b?0:b);this.z=Number(0==c?0:c)}function l(a,b){return new k(a.x-b.x,a.y-b.y,a.z-b.z)}function m(a,b){return new k(a.x+b.x,a.y+b.y,a.z+b.z)}
k.prototype.rotate=function(a,b){b=b/180*Math.PI;var c=Math.sin(b);b=Math.cos(b);return n(this,[[("x"===a?1:b).toFixed(15),("z"===a?c:0).toFixed(15),("y"===a?-1*c:0).toFixed(15)],[("z"===a?-1*c:0).toFixed(15),("y"===a?1:b).toFixed(15),("x"===a?c:0).toFixed(15)],[("y"===a?c:0).toFixed(15),("x"===a?-1*c:0).toFixed(15),("z"===a?1:b).toFixed(15)]])};
k.prototype.A=function(a,b){var c=a.o.normalize(),d=c.x,g=c.y;c=c.z;var f=b/180*Math.PI;b=Math.sin(f);f=Math.cos(f);return m(n(l(this,a.w),[[d*d*(1-f)+f,g*d*(1-f)+c*b,c*d*(1-f)-g*b],[d*g*(1-f)-c*b,g*g*(1-f)+f,c*g*(1-f)+d*b],[d*c*(1-f)+g*b,g*c*(1-f)-d*b,c*c*(1-f)+f]]),a.w)};k.prototype.normalize=function(){var a=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return new k(this.x*a,this.y*a,this.z*a)};
function n(a,b){return new k((b[0][0]*a.x+b[1][0]*a.y+b[2][0]*a.z).toFixed(15),(b[0][1]*a.x+b[1][1]*a.y+b[2][1]*a.z).toFixed(15),(b[0][2]*a.x+b[1][2]*a.y+b[2][2]*a.z).toFixed(15))}function p(a,b){return a.x*b.x-a.y*b.y-a.z*b.z}"use strict";function q(a,b){var c=new k(0,0,0);a=l(a,c);b=l(b,c);if(a.x/b.x===a.y/b.y&&a.x/b.y===a.z/b.z&&a.y/b.y===a.z/b.z)throw Error("Cannot create plane, r1 and r2 are linearly dependent");this.n=new k(b.y*a.z-b.z*a.y,b.z*a.x-b.x*a.z,b.x*a.y-b.y*a.x);this.T=c}"use strict";
function t(a,b){this.w=a;this.o=l(b,a);this.S=b}t.prototype.rotate=function(a,b){0<a&&(this.o=this.o.rotate("x",a));0<b&&(this.o=this.o.rotate("z",b))};t.prototype.A=function(a,b){return new t(this.w.A(a,b),this.S.A(a,b))};
function u(){this.socket=io.connect(document.location.protocol+"//"+document.location.host);this.socket.on("mobile-on",function(){$(window).trigger("mobile-connected")});this.socket.on("orientation",function(a){$(window).trigger("orientation-change",a)});this.socket.on("brush-change",function(a){$(window).trigger("brush-change",a)});this.socket.on("brush-mode",function(a){$(window).trigger("brush-mode",a)})}function v(a){this.socket.emit("desktop-getcode","nothing",function(b){a(b)})}
function w(){this.c={};this.c.canvas=document.getElementById("canvas");this.c.toolbar=document.getElementById("toolbar");this.c.Z=document.getElementById("toolbar-item--clear");this.c.M=document.getElementById("brush-stroke-preview");this.c.Z.addEventListener("click",function(){x()});this.c.Y=document.getElementById("toolbar-colors");for(var a in e)if(e.hasOwnProperty(a)){var b=document.createElement("div");b.className="toolbar__item toolbar__item--color";b.name="color";b.dataset.P=e[a].name;b.style.background=
e[a].i;e[a].default&&(b.classList.add("active"),y(e[a].name));b.addEventListener("click",function(){y(this.dataset.P)});this.c.Y.appendChild(b)}this.f=[];a=document.querySelectorAll(".toolbar__item");for(b=0;b<a.length;++b){var c=a[b].getBoundingClientRect(),d=c.width/2;this.f.push({element:a[b],V:d,position:{x:c.left+d,y:c.top+d}})}this.l=this.j=this.K=this.J=this.h=this.m=0;this.u="move";this.C=this.v=!1;this.D=!0;$("body").addClass("app-is-ready")}
function z(){A();this.H=this.O;this.G=this.N;var a=2*this.O,b=this.H/2,c=this.G/2;this.W=new q(new k(this.H,0,0),new k(0,this.G,0));this.aa=new t(new k(b-100,c,a),new k(b+100,c,a));this.ba=new t(new k(b,c-100,a),new k(b,c+100,a));this.U=new t(new k(b,c,a),new k(b,c,a/2));$(".setup-container").addClass("setup-disappear");window.setTimeout(function(){$(".setup-container").addClass("setup-hide")},400);B()}function A(){this.O=$(window).width();this.N=$(window).height()}
function C(a){$("#brush-circle")[0].setAttribute("r",a.size/2);D(a.size);this.c.M.style.ga=a.size}function E(a){this.u=a;this.v=!0}function y(a){$("#brush-circle")[0].style.fill=e[a].i;F(e[a].i);this.c.M.style.stroke=e[a].i}
function B(){var a=G();a=this.U.A(this.ba,180-a.alpha).A(this.aa,180-a.beta);var b=this.W,c=p(l(b.T,a.w),b.n),d=p(a.o,b.n);0==c||0==d?a=null:(b=a.o,c/=d,a=m(new k(b.x*c,b.y*c,b.z*c),a.w));c=a.y/2;this.m=Math.round(a.x/2);this.h=Math.round(c);a=15-(Math.abs(this.m-this.J)+Math.abs(this.h-this.K))/5;a=Math.max(a,3);this.h<=-.3*this.N&&this.D?(this.D=!1,this.C=0==this.C?!0:!1):40<=this.h&&(this.D=!0);if("secondary"===this.u||1==this.C)for($("body").addClass("toolbar-is-active"),c=0;c<this.f.length;++c){b=
this.m;d=this.h;var g=this.f[c].position.x,f=this.f[c].position.y,r=this.f[c].V;(b-g)*(b-g)+(d-f)*(d-f)>=r*r?this.f[c].element.classList.remove("hover"):(this.f[c].element.classList.add("hover"),"draw"===this.u&&this.f[c].element.click())}else for($("body").removeClass("toolbar-is-active"),c=0;c<this.f.length;++c)this.f[c].element.classList.contains("hover")&&(this.f[c].element.click(),this.f[c].element.classList.remove("hover"));c=this.m;b=this.h;d=this.j;g=this.l;1600<=(c-d)*(c-d)+(b-g)*(b-g)&&
(this.j=Math.round(this.j+(this.m-this.j)/a),this.l=Math.round(this.l+(this.h-this.l)/a));$("#brush-anchor").css("transform","translate3d("+this.j+"px,"+this.l+"px,0)");$("#cursor-anchor").css("transform","translate3d("+this.m+"px,"+this.h+"px,0)");console.log(this.u);"draw"===this.u&&0==this.C?!0===this.v?($(this.c.canvas).trigger("brush:down"),H(this.j,this.l),this.v=!1):($(this.c.canvas).trigger("brush:move"),I(this.j,this.l)):!0===this.v&&($(this.c.canvas).trigger("brush:up"),J(),this.v=!1);this.K=
this.h;this.J=this.m;window.requestAnimationFrame(this.fa.bind(this))}function G(){return{alpha:this.R.alpha,beta:this.R.beta}}
function K(){console.log("canvas init");this.canvas=document.getElementById("canvas-drawing-main");this.I=this.canvas.getContext("2d");this.X=document.getElementById("canvas-container");this.L=getComputedStyle(this.X);this.canvas.width=parseInt(this.L.getPropertyValue("width"));this.canvas.height=parseInt(this.L.getPropertyValue("height"));this.g=document.getElementById("canvas-drawing-tmp");this.a=this.g.getContext("2d");this.g.width=this.canvas.width;this.g.height=this.canvas.height;this.a.lineWidth=
20;this.a.lineJoin="round";this.a.lineCap="round";this.a.strokeStyle="blue";this.a.fillStyle="blue";this.s={x:0,y:0};this.b=[];this.F=!1;this.g.addEventListener("mousemove",function(a){console.log("x"+a.offsetX);console.log("y"+a.offsetY)},!1)}function F(a){this.a.strokeStyle=a;this.a.fillStyle=a}function D(a){this.a.lineWidth=a}function x(){this.I.clearRect(0,0,this.g.width,this.g.height)}function I(a,b){this.F&&(this.s.x=a,this.s.y=b,L())}
function H(a,b){this.F=!0;this.s.x=a;this.s.y=b;this.b.push({x:a,y:b});L()}function J(){this.F=!1;this.I.drawImage(this.g,0,0);this.a.clearRect(0,0,this.g.width,this.g.height);this.b=[]}
function L(){this.b.push({x:this.s.x,y:this.s.y});if(3>this.b.length){var a=this.b[0];this.a.beginPath();this.a.arc(a.x,a.y,this.a.lineWidth/2,0,2*Math.PI,!0);this.a.fill();this.a.closePath();console.log(a)}else{this.a.clearRect(0,0,this.g.width,this.g.height);this.a.beginPath();this.a.moveTo(this.b[0].x,this.b[0].y);for(a=1;a<this.b.length-2;a++)this.a.quadraticCurveTo(this.b[a].x,this.b[a].y,(this.b[a].x+this.b[a+1].x)/2,(this.b[a].y+this.b[a+1].y)/2);this.a.quadraticCurveTo(this.b[a].x,this.b[a].y,
this.b[a+1].x,this.b[a+1].y);this.a.stroke()}}function M(){this.B=new h;u();K();w();v(function(a){$(".setup-code").html(a)});$(window).bind("mobile-connected",N);$(window).bind("orientation-change",O);$(window).bind("brush-change",P);$(window).bind("brush-mode",Q)}function N(){z()}function O(){}function P(a,b){this.B=b;C(this.B)}function Q(a,b){this.B.mode=b;E(this.B.mode)}$(document).ready(function(){M()});
}).call(this)
